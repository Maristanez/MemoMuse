<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MemoMuse ‚Äî Voice to Music</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    :root{
      --red:#e63946;--red-g:rgba(230,57,70,.35);
      --teal:#2dd4bf;--teal-g:rgba(45,212,191,.25);
      --purple:#a78bfa;--purple-g:rgba(167,139,250,.2);
      --amber:#f59e0b;--amber-g:rgba(245,158,11,.2);
      --bg:#050507;
      --surface:rgba(255,255,255,.03);
      --border:rgba(255,255,255,.07);
      --t1:#f5f5f5;--t2:#9ca3af;--t3:#4b5563;
    }
    body{
      font-family:'Inter',system-ui,sans-serif;
      background:var(--bg);color:var(--t1);overflow-x:hidden;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    nav{
      position:fixed;top:0;left:0;width:100%;z-index:100;
      padding:1.25rem 2rem;
      display:flex;align-items:center;justify-content:space-between;
      background:rgba(5,5,7,.6);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
      border-bottom:1px solid var(--border);
      transition:all .3s;
    }
    .nav-logo{
      font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:1.3rem;
      display:flex;align-items:center;gap:.6rem;letter-spacing:-.02em;
    }
    .nav-logo .icon{
      width:32px;height:32px;border-radius:8px;
      background:linear-gradient(135deg,var(--red),#ff6b7a);
      display:flex;align-items:center;justify-content:center;font-size:.9rem;
    }
    .nav-links{display:flex;gap:2rem}
    .nav-links a{
      color:var(--t2);font-size:.85rem;text-decoration:none;font-weight:500;
      transition:color .2s;position:relative;
    }
    .nav-links a::after{
      content:'';position:absolute;bottom:-4px;left:0;width:0;height:1.5px;
      background:var(--red);transition:width .25s cubic-bezier(.16,1,.3,1);
    }
    .nav-links a:hover{color:#fff}
    .nav-links a:hover::after{width:100%}
    .nav-cta{
      padding:.55rem 1.3rem;border-radius:10px;border:none;
      background:var(--red);color:#fff;font-size:.85rem;font-family:inherit;font-weight:600;
      cursor:pointer;transition:all .25s;
    }
    .nav-cta:hover{transform:translateY(-1px);box-shadow:0 4px 20px var(--red-g)}
    .nav-cta:active{transform:translateY(0) scale(.97)}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HERO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .hero{
      min-height:100vh;display:flex;flex-direction:column;
      align-items:center;justify-content:center;
      text-align:center;padding:8rem 2rem 6rem;
      position:relative;
    }
    .hero-glow{
      position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden;
    }
    .hero-glow .orb{
      position:absolute;border-radius:50%;filter:blur(100px);
      animation:float 14s ease-in-out infinite alternate;
    }
    .hero-glow .orb:nth-child(1){
      width:600px;height:600px;background:rgba(230,57,70,.15);
      top:-20%;left:-10%;
    }
    .hero-glow .orb:nth-child(2){
      width:500px;height:500px;background:rgba(45,212,191,.1);
      bottom:-15%;right:-10%;animation-delay:5s;
    }
    .hero-glow .orb:nth-child(3){
      width:300px;height:300px;background:rgba(167,139,250,.1);
      top:30%;left:50%;animation-delay:8s;
    }
    @keyframes float{
      0%{transform:translate(0,0) scale(1)}
      100%{transform:translate(60px,40px) scale(1.15)}
    }

    .hero-badge{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.45rem 1rem;border-radius:99px;
      background:rgba(230,57,70,.1);border:1px solid rgba(230,57,70,.2);
      color:var(--red);font-size:.78rem;font-weight:600;
      margin-bottom:2rem;letter-spacing:.03em;
      text-transform:uppercase;
      animation:fadeIn .8s ease;
    }
    .hero-badge .pulse-dot{
      width:7px;height:7px;border-radius:50%;background:var(--red);
      animation:pulse-dot 2s ease-in-out infinite;
    }
    @keyframes pulse-dot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.8)}}

    .hero h1{
      font-family:'Space Grotesk',sans-serif;
      font-size:clamp(2.8rem,7vw,5.5rem);font-weight:700;
      line-height:1.05;letter-spacing:-.04em;
      margin-bottom:1.5rem;position:relative;z-index:1;
      animation:fadeUp .8s ease;
    }
    .hero h1 .gradient{
      background:linear-gradient(135deg,var(--red),var(--purple),var(--teal),var(--red));
      background-size:200% 200%;
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      background-clip:text;animation:gradientShift 6s ease-in-out infinite;
    }
    @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .hero .subtitle{
      font-size:clamp(1rem,2.5vw,1.3rem);color:var(--t2);
      max-width:540px;line-height:1.6;margin-bottom:3rem;
      animation:fadeUp .8s ease .15s both;
    }
    .hero-actions{
      display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;
      animation:fadeUp .8s ease .3s both;
    }
    .btn-primary{
      padding:.9rem 2rem;border-radius:14px;border:none;
      background:linear-gradient(135deg,var(--red),#ff4757);
      color:#fff;font-size:1rem;font-family:inherit;font-weight:600;
      cursor:pointer;transition:all .3s;
      box-shadow:0 4px 24px var(--red-g);
      display:flex;align-items:center;gap:.5rem;
    }
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 36px var(--red-g)}
    .btn-primary:active{transform:translateY(0) scale(.97);box-shadow:0 2px 12px var(--red-g)}
    .btn-secondary{
      padding:.9rem 2rem;border-radius:14px;
      border:1px solid var(--border);background:var(--surface);
      color:#fff;font-size:1rem;font-family:inherit;font-weight:500;
      cursor:pointer;transition:all .3s;
      backdrop-filter:blur(12px);
    }
    .btn-secondary:hover{border-color:rgba(255,255,255,.15);background:rgba(255,255,255,.06)}
    .btn-secondary:active{transform:scale(.97)}

    .hero-visual{
      margin-top:5rem;position:relative;z-index:1;
      width:100%;max-width:700px;
      animation:fadeUp 1s ease .45s both;
    }
    .waveform-art{
      display:flex;align-items:end;justify-content:center;gap:3px;
      height:100px;padding:0 2rem;
    }
    .waveform-art .bar{
      width:4px;border-radius:4px;
      background:linear-gradient(to top,var(--red),var(--purple));
      animation:artWave 2s ease-in-out infinite;
      opacity:.6;
    }
    @keyframes artWave{0%,100%{height:15%}50%{height:90%}}

    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SECTION COMMONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    section{padding:7rem 2rem;position:relative}
    .section-label{
      font-size:.72rem;font-weight:700;text-transform:uppercase;
      letter-spacing:.15em;color:var(--red);margin-bottom:1rem;
    }
    .section-title{
      font-family:'Space Grotesk',sans-serif;
      font-size:clamp(2rem,4vw,3rem);font-weight:700;
      letter-spacing:-.03em;line-height:1.15;margin-bottom:1rem;
    }
    .section-sub{color:var(--t2);font-size:1.05rem;line-height:1.7;max-width:560px}
    .section-center{text-align:center;display:flex;flex-direction:column;align-items:center}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HOW IT WORKS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .how-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:1.5rem;margin-top:3.5rem;max-width:1000px;width:100%;
    }
    .how-card{
      background:var(--surface);border:1px solid var(--border);
      border-radius:20px;padding:2rem 1.5rem;
      transition:transform .35s cubic-bezier(.16,1,.3,1),border-color .35s,box-shadow .35s;
      position:relative;overflow:hidden;
    }
    .how-card:hover{
      border-color:rgba(255,255,255,.12);transform:translateY(-6px);
      box-shadow:0 12px 40px rgba(0,0,0,.4),0 0 0 1px rgba(255,255,255,.05);
    }
    .how-card::after{
      content:'';position:absolute;top:0;left:0;width:100%;height:100%;
      background:radial-gradient(circle at var(--mx,50%) var(--my,50%),rgba(255,255,255,.04),transparent 60%);
      opacity:0;transition:opacity .35s;pointer-events:none;
    }
    .how-card:hover::after{opacity:1}
    .how-card .num{
      font-family:'Space Grotesk',sans-serif;
      font-size:3.5rem;font-weight:700;
      line-height:1;margin-bottom:.75rem;
      background:linear-gradient(135deg,var(--red),transparent 80%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      opacity:.5;
    }
    .how-card:nth-child(2) .num{
      background:linear-gradient(135deg,var(--purple),transparent 80%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .how-card:nth-child(3) .num{
      background:linear-gradient(135deg,var(--teal),transparent 80%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .how-card:nth-child(4) .num{
      background:linear-gradient(135deg,var(--amber),transparent 80%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .how-card h3{font-size:1.1rem;font-weight:600;margin-bottom:.5rem}
    .how-card p{color:var(--t2);font-size:.88rem;line-height:1.6}
    .how-card .glow-line{
      position:absolute;bottom:0;left:0;width:100%;height:2px;
      background:linear-gradient(90deg,transparent,var(--red),transparent);
      opacity:0;transition:opacity .35s;
    }
    .how-card:hover .glow-line{opacity:1}
    .how-card:nth-child(2) .glow-line{background:linear-gradient(90deg,transparent,var(--purple),transparent)}
    .how-card:nth-child(3) .glow-line{background:linear-gradient(90deg,transparent,var(--teal),transparent)}
    .how-card:nth-child(4) .glow-line{background:linear-gradient(90deg,transparent,var(--amber),transparent)}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ STUDIO SECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    #studio{
      min-height:100vh;display:flex;flex-direction:column;
      align-items:center;justify-content:center;
      padding:6rem 2rem;
    }
    .studio-card{
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:28px;padding:3rem;width:100%;max-width:600px;
      backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);
      box-shadow:0 8px 80px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.05);
      margin-top:3rem;position:relative;overflow:hidden;
    }
    .studio-card::before{
      content:'';position:absolute;top:-1px;left:20%;right:20%;height:1px;
      background:linear-gradient(90deg,transparent,rgba(230,57,70,.4),transparent);
    }

    .genre-grid{
      display:grid;grid-template-columns:repeat(4,1fr);gap:.6rem;margin-bottom:1.75rem;
    }
    .genre-chip{
      padding:.65rem .5rem;border-radius:12px;
      background:rgba(255,255,255,.04);border:1px solid var(--border);
      color:var(--t2);font-size:.78rem;font-family:inherit;font-weight:500;
      cursor:pointer;transition:all .25s cubic-bezier(.16,1,.3,1);text-align:center;
    }
    .genre-chip:hover{border-color:rgba(255,255,255,.15);color:#fff;background:rgba(255,255,255,.07)}
    .genre-chip:active{transform:scale(.95)}
    .genre-chip.selected{
      border-color:var(--red);color:#fff;
      background:rgba(230,57,70,.12);
      box-shadow:0 0 20px rgba(230,57,70,.15);
      animation:chipSelect .3s cubic-bezier(.16,1,.3,1);
    }
    @keyframes chipSelect{0%{transform:scale(.92)}50%{transform:scale(1.04)}100%{transform:scale(1)}}

    .record-area{
      display:flex;flex-direction:column;align-items:center;
      padding:2rem 0;gap:1rem;
    }
    .big-record-btn{
      width:88px;height:88px;border-radius:50%;border:none;
      background:linear-gradient(135deg,var(--red),#ff4757);
      color:#fff;font-size:1.6rem;cursor:pointer;
      transition:all .3s;position:relative;
      box-shadow:0 4px 30px var(--red-g);
      display:flex;align-items:center;justify-content:center;
    }
    .big-record-btn::before{
      content:'';position:absolute;inset:-6px;border-radius:50%;
      border:2px solid rgba(230,57,70,.25);
      transition:all .3s;
    }
    .big-record-btn:hover{transform:scale(1.05);box-shadow:0 8px 40px var(--red-g)}
    .big-record-btn:hover::before{inset:-10px;border-color:rgba(230,57,70,.35)}
    .big-record-btn.recording{
      background:linear-gradient(135deg,var(--red),#ff4757);
      box-shadow:0 4px 30px var(--red-g);
      animation:recording-pulse 1.5s ease-in-out infinite;
    }
    .big-record-btn.recording::before{
      border-color:var(--red);animation:ring-expand 2s ease-out infinite;
    }
    .big-record-btn.recording::after{
      content:'';position:absolute;inset:-6px;border-radius:50%;
      border:2px solid rgba(230,57,70,.2);
      animation:ring-expand 2s ease-out .7s infinite;
    }
    @keyframes recording-pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
    @keyframes ring-expand{0%{inset:-6px;opacity:.8}100%{inset:-30px;opacity:0}}
    .record-label{font-size:.85rem;color:var(--t2);font-weight:500;transition:all .3s}
    .studio-card.recording-active{
      border-color:rgba(230,57,70,.2);
      box-shadow:0 8px 80px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.05),0 0 60px rgba(230,57,70,.08);
      transition:border-color .4s,box-shadow .4s;
    }

    .live-viz{
      width:100%;height:64px;border-radius:16px;
      background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.05);
      display:flex;align-items:center;justify-content:center;gap:2px;
      padding:0 2rem;margin:1rem 0 1.5rem;
      transition:all .4s;overflow:hidden;
    }
    .live-viz.active{background:rgba(230,57,70,.04);border-color:rgba(230,57,70,.12)}
    .live-viz .vbar{
      width:3px;border-radius:3px;
      background:linear-gradient(to top,var(--red),var(--purple));
      height:4px;transition:height .1s ease;flex-shrink:0;
    }
    .live-viz.active .vbar{animation:vizWave .5s ease-in-out infinite}
    @keyframes vizWave{0%,100%{height:4px}50%{height:48px}}

    .gen-btn{
      width:100%;padding:1rem;border-radius:16px;border:none;
      background:linear-gradient(135deg,var(--teal),#14b8a6);
      color:#064e3b;font-size:1rem;font-family:'Space Grotesk',sans-serif;
      font-weight:700;cursor:pointer;transition:all .3s;
      box-shadow:0 4px 24px var(--teal-g);
      display:flex;align-items:center;justify-content:center;gap:.6rem;
      letter-spacing:-.01em;
    }
    .gen-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 36px var(--teal-g)}
    .gen-btn:active:not(:disabled){transform:translateY(0) scale(.98)}
    .gen-btn:disabled{
      background:rgba(255,255,255,.05);color:var(--t3);
      box-shadow:none;cursor:not-allowed;
    }
    .gen-btn .spinner{
      display:none;width:20px;height:20px;border:2.5px solid rgba(6,78,59,.25);
      border-top-color:#064e3b;border-radius:50%;animation:spin .7s linear infinite;
    }
    .gen-btn.loading .spinner{display:block}
    .gen-btn.loading .btn-label{display:none}
    .gen-btn.loading{
      background:linear-gradient(135deg,var(--teal),#14b8a6,var(--teal));
      background-size:200% 100%;animation:shimmerBtn 2s ease-in-out infinite;
    }
    @keyframes shimmerBtn{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    @keyframes spin{to{transform:rotate(360deg)}}

    .pipeline-steps{
      display:flex;gap:.75rem;justify-content:center;
      margin-top:1.25rem;flex-wrap:wrap;display:none;
    }
    .pipeline-steps.visible{display:flex}
    .pstep{
      display:flex;align-items:center;gap:.35rem;
      font-size:.72rem;font-weight:600;color:var(--t3);
      transition:color .3s,transform .3s cubic-bezier(.16,1,.3,1);
    }
    .pstep.active{color:var(--t2);transform:scale(1.05)}
    .pstep.done{color:var(--teal)}
    .pstep .pdot{
      width:7px;height:7px;border-radius:50%;
      background:var(--t3);transition:all .3s;
    }
    .pstep.active .pdot{
      background:var(--amber);box-shadow:0 0 12px rgba(245,158,11,.4);
      animation:stepPulse 1.2s ease-in-out infinite;
    }
    .pstep.done .pdot{
      background:var(--teal);box-shadow:0 0 10px var(--teal-g);
      animation:stepDone .35s cubic-bezier(.16,1,.3,1);
    }
    @keyframes stepPulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.4);opacity:.6}}
    @keyframes stepDone{0%{transform:scale(0)}60%{transform:scale(1.3)}100%{transform:scale(1)}}
    .pstep-line{width:20px;height:1px;background:var(--t3);flex-shrink:0;transition:background .4s}

    .status-text{
      margin-top:1.25rem;color:var(--t2);font-size:.85rem;
      text-align:center;min-height:1.4em;
      transition:color .3s,opacity .2s;line-height:1.5;
    }
    .status-text.fade-out{opacity:0}
    .status-text.success{color:var(--teal)}
    .status-text.error{color:var(--red)}

    .output-player{
      margin-top:2rem;width:100%;display:none;
    }
    .output-player.visible{display:block;animation:slideUp .5s cubic-bezier(.16,1,.3,1) both}
    .output-player.visible .output-header{animation:slideUp .4s cubic-bezier(.16,1,.3,1) .05s both}
    .output-player.visible .player-box{animation:slideUp .4s cubic-bezier(.16,1,.3,1) .1s both}
    .output-player.visible .track-meta{animation:slideUp .4s cubic-bezier(.16,1,.3,1) .18s both}
    .output-player.visible .lyrics-display{animation:slideUp .4s cubic-bezier(.16,1,.3,1) .24s both}
    .output-player.visible .output-actions{animation:slideUp .4s cubic-bezier(.16,1,.3,1) .3s both}
    @keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
    .output-header{
      display:flex;align-items:center;justify-content:space-between;
      margin-bottom:.75rem;
    }
    .output-tag{
      font-size:.7rem;font-weight:700;text-transform:uppercase;
      letter-spacing:.12em;color:var(--teal);
      display:flex;align-items:center;gap:.4rem;
    }
    .output-tag::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--teal);animation:tagPulse 2s ease-in-out infinite}
    @keyframes tagPulse{0%,100%{box-shadow:0 0 0 0 var(--teal-g)}50%{box-shadow:0 0 8px 2px var(--teal-g)}}
    .player-box{
      background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);
      border-radius:16px;padding:1rem 1.25rem;
    }
    .player-box audio{
      width:100%;height:40px;border-radius:8px;
      filter:invert(1) hue-rotate(180deg) brightness(.85) contrast(1.1);
    }

    .track-meta{
      display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.75rem;
    }
    .meta-pill{
      padding:.3rem .7rem;border-radius:8px;font-size:.7rem;font-weight:600;
      background:rgba(255,255,255,.05);border:1px solid var(--border);color:var(--t2);
      display:flex;align-items:center;gap:.3rem;
      animation:pillPop .35s cubic-bezier(.16,1,.3,1) both;
    }
    .meta-pill:nth-child(1){animation-delay:.2s}
    .meta-pill:nth-child(2){animation-delay:.28s}
    .meta-pill:nth-child(3){animation-delay:.36s}
    .meta-pill:nth-child(4){animation-delay:.44s}
    @keyframes pillPop{from{opacity:0;transform:scale(.8) translateY(6px)}to{opacity:1;transform:scale(1) translateY(0)}}
    .meta-pill .meta-val{color:#fff}

    .lyrics-display{
      margin-top:1.25rem;
      background:rgba(255,255,255,.02);border:1px solid var(--border);
      border-radius:18px;padding:1.5rem;
      position:relative;overflow:hidden;
      max-height:280px;overflow-y:auto;
      scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.1) transparent;
    }
    .lyrics-display::-webkit-scrollbar{width:4px}
    .lyrics-display::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:4px}
    .lyrics-display::before{
      content:'';position:absolute;top:0;left:0;right:0;height:30px;
      background:linear-gradient(to bottom,rgba(5,5,7,.9),transparent);
      pointer-events:none;z-index:2;
    }
    .lyrics-display::after{
      content:'';position:absolute;bottom:0;left:0;right:0;height:30px;
      background:linear-gradient(to top,rgba(5,5,7,.9),transparent);
      pointer-events:none;z-index:2;
    }
    .lyrics-label{
      font-size:.68rem;font-weight:700;text-transform:uppercase;
      letter-spacing:.12em;color:var(--t3);margin-bottom:.75rem;
      display:flex;align-items:center;gap:.4rem;
    }
    .lyrics-label .eq-bars{display:flex;gap:2px;align-items:end;height:12px}
    .lyrics-label .eq-bars span{
      width:2px;border-radius:1px;background:var(--red);
      animation:eqBar .8s ease-in-out infinite alternate;
    }
    .lyrics-label .eq-bars span:nth-child(1){height:4px;animation-delay:0s}
    .lyrics-label .eq-bars span:nth-child(2){height:8px;animation-delay:.15s}
    .lyrics-label .eq-bars span:nth-child(3){height:6px;animation-delay:.3s}
    .lyrics-label .eq-bars span:nth-child(4){height:10px;animation-delay:.1s}
    .lyrics-label .eq-bars.paused span{animation-play-state:paused}
    @keyframes eqBar{0%{height:3px}100%{height:12px}}
    .lyric-line{
      font-size:.95rem;line-height:2;color:var(--t3);
      transition:all .4s cubic-bezier(.16,1,.3,1);
      padding:2px 0;
    }
    .lyric-line.active{
      color:#fff;font-weight:500;
      text-shadow:0 0 20px var(--red-g);
      transform:scale(1.02);transform-origin:left center;
    }
    .lyric-line.past{color:var(--t2)}
    .lyric-line.section-label{
      font-size:.72rem;font-weight:700;text-transform:uppercase;
      letter-spacing:.1em;color:var(--red);opacity:.6;
      margin-top:.5rem;
    }
    .lyric-line.section-label.active{opacity:1;text-shadow:none}
    .lyric-line.section-label.past{opacity:.4}

    .output-actions{
      display:flex;gap:.6rem;margin-top:1rem;
    }
    .action-btn{
      flex:1;padding:.7rem;border-radius:12px;border:1px solid var(--border);
      background:rgba(255,255,255,.04);color:#fff;font-size:.8rem;
      font-family:inherit;font-weight:600;cursor:pointer;
      transition:all .25s;display:flex;align-items:center;justify-content:center;gap:.4rem;
    }
    .action-btn:hover{border-color:rgba(255,255,255,.15);background:rgba(255,255,255,.07)}
    .action-btn:active{transform:scale(.96)}
    .action-btn.primary{
      border-color:var(--teal);background:rgba(45,212,191,.1);color:var(--teal);
    }
    .action-btn.primary:hover{background:rgba(45,212,191,.18)}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ VINYL RECORD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .vinyl-section{
      margin-top:1.5rem;display:flex;flex-direction:column;align-items:center;gap:1.25rem;
    }
    .vinyl-wrap{
      position:relative;width:200px;height:200px;
    }
    .vinyl-record{
      width:200px;height:200px;border-radius:50%;
      background:radial-gradient(circle at 50% 50%,
        #1a1a1a 0%,#1a1a1a 15%,
        #111 15.5%,#222 16%,#111 17%,
        #222 20%,#111 21%,#222 24%,#111 25%,
        #222 28%,#111 29%,#222 32%,#111 33%,
        #1a1a1a 36%,#222 40%,#111 41%,#222 44%,
        #111 45%,#222 48%,#111 49%,#222 52%,
        #111 53%,#222 56%,#111 57%,#222 60%,
        #111 61%,#1a1a1a 65%,
        #222 70%,#111 71%,#222 74%,#111 75%,
        #222 78%,#111 79%,#222 82%,#111 83%,
        #222 86%,#111 87%,#222 90%,#111 91%,
        #222 94%,#111 95%,#1a1a1a 100%
      );
      box-shadow:0 4px 40px rgba(0,0,0,.6),inset 0 0 30px rgba(0,0,0,.4);
      animation:vinylSpin 4s linear infinite;
      animation-play-state:paused;
    }
    .vinyl-record.spinning{animation-play-state:running}
    .vinyl-record::after{
      content:'';position:absolute;top:50%;left:50%;
      width:50px;height:50px;border-radius:50%;
      transform:translate(-50%,-50%);
      background:linear-gradient(135deg,var(--red),#ff6b7a);
      box-shadow:0 0 20px var(--red-g);
    }
    .vinyl-label{
      position:absolute;top:50%;left:50%;
      transform:translate(-50%,-50%);
      width:70px;height:70px;border-radius:50%;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      z-index:2;pointer-events:none;
    }
    .vinyl-label .v-title{
      font-family:'Space Grotesk',sans-serif;
      font-size:.45rem;font-weight:700;color:#fff;
      text-align:center;line-height:1.2;
      max-width:55px;overflow:hidden;
      text-overflow:ellipsis;white-space:nowrap;
    }
    .vinyl-label .v-genre{
      font-size:.35rem;color:rgba(255,255,255,.7);
      text-transform:uppercase;letter-spacing:.05em;
    }
    @keyframes vinylSpin{to{transform:rotate(360deg)}}

    .vinyl-info{text-align:center}
    .vinyl-info h3{
      font-family:'Space Grotesk',sans-serif;
      font-size:1.1rem;font-weight:700;margin-bottom:.25rem;
    }
    .vinyl-info p{font-size:.82rem;color:var(--t2);line-height:1.5}

    .shopify-btn{
      width:100%;padding:.85rem;border-radius:14px;border:none;
      background:linear-gradient(135deg,#96bf48,#5a8a00);
      color:#fff;font-size:.9rem;font-family:'Space Grotesk',sans-serif;
      font-weight:700;cursor:pointer;transition:all .3s;
      box-shadow:0 4px 20px rgba(150,191,72,.25);
      display:flex;align-items:center;justify-content:center;gap:.5rem;
    }
    .shopify-btn:hover{transform:translateY(-1px);box-shadow:0 8px 32px rgba(150,191,72,.3)}
    .shopify-btn:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}
    .shopify-btn .s-spinner{
      display:none;width:18px;height:18px;border:2.5px solid rgba(255,255,255,.3);
      border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;
    }
    .shopify-btn.loading .s-spinner{display:block}
    .shopify-btn.loading .s-label{display:none}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GENRES SHOWCASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .genres-section{overflow:hidden}
    .genres-scroll{
      display:flex;gap:1rem;margin-top:3rem;
      animation:scroll-x 30s linear infinite;
      width:max-content;
    }
    .genres-scroll:hover{animation-play-state:paused}
    .genre-tag{
      padding:.7rem 1.5rem;border-radius:99px;
      background:var(--surface);border:1px solid var(--border);
      color:var(--t2);font-size:.9rem;font-weight:500;
      white-space:nowrap;transition:all .3s;flex-shrink:0;cursor:default;
    }
    .genre-tag:hover{transform:scale(1.06);background:rgba(255,255,255,.06)}
    .genre-tag:nth-child(odd){border-color:rgba(230,57,70,.15);color:rgba(230,57,70,.7)}
    .genre-tag:nth-child(3n){border-color:rgba(167,139,250,.15);color:rgba(167,139,250,.7)}
    .genre-tag:nth-child(4n){border-color:rgba(45,212,191,.15);color:rgba(45,212,191,.7)}
    @keyframes scroll-x{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ TECH STACK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .tech-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:1rem;margin-top:3rem;max-width:800px;width:100%;
    }
    .tech-card{
      padding:1.5rem;border-radius:16px;
      background:var(--surface);border:1px solid var(--border);
      transition:transform .3s cubic-bezier(.16,1,.3,1),border-color .3s,box-shadow .3s;
      text-align:center;position:relative;overflow:hidden;
    }
    .tech-card::after{
      content:'';position:absolute;top:0;left:0;width:100%;height:100%;
      background:radial-gradient(circle at var(--mx,50%) var(--my,50%),rgba(255,255,255,.06),transparent 60%);
      opacity:0;transition:opacity .3s;pointer-events:none;
    }
    .tech-card:hover{
      border-color:rgba(255,255,255,.12);transform:translateY(-4px);
      box-shadow:0 8px 30px rgba(0,0,0,.3);
    }
    .tech-card:hover::after{opacity:1}
    .tech-card .tech-icon{font-size:1.8rem;margin-bottom:.6rem;transition:transform .3s cubic-bezier(.16,1,.3,1)}
    .tech-card:hover .tech-icon{transform:scale(1.15) translateY(-2px)}
    .tech-card .tech-name{font-size:.85rem;font-weight:600;margin-bottom:.25rem}
    .tech-card .tech-role{font-size:.75rem;color:var(--t2)}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    footer{
      padding:3rem 2rem;text-align:center;
      border-top:1px solid var(--border);
    }
    footer .f-logo{
      font-family:'Space Grotesk',sans-serif;font-weight:700;
      font-size:1.1rem;margin-bottom:.5rem;
    }
    footer p{color:var(--t3);font-size:.8rem}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LIVE VIZ SMOOTH ENTRY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .live-viz.active{animation:vizFadeIn .4s cubic-bezier(.16,1,.3,1)}
    @keyframes vizFadeIn{from{opacity:.5;transform:scaleY(.8)}to{opacity:1;transform:scaleY(1)}}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SCROLL ANIMATIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .reveal{opacity:0;transform:translateY(40px);transition:all .7s cubic-bezier(.16,1,.3,1)}
    .reveal.visible{opacity:1;transform:translateY(0)}
    .how-card.reveal{transition-delay:calc(var(--i,0) * 80ms)}
    .tech-card.reveal{transition-delay:calc(var(--i,0) * 60ms)}

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ REDUCED MOTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    @media(prefers-reduced-motion:reduce){
      *,*::before,*::after{
        animation-duration:0.01ms !important;
        animation-iteration-count:1 !important;
        transition-duration:0.01ms !important;
      }
      .reveal{opacity:1;transform:none}
      .genres-scroll{animation:none}
      .hero-glow .orb{animation:none}
      .waveform-art .bar{animation:none;height:40%}
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    @media(max-width:640px){
      nav{padding:1rem}
      .nav-links{display:none}
      .genre-grid{grid-template-columns:repeat(2,1fr)}
      .how-grid{grid-template-columns:1fr}
      .studio-card{padding:2rem 1.5rem}
      .tech-grid{grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-logo">
    <div class="icon">üéµ</div>
    MemoMuse
  </div>
  <div class="nav-links">
    <a href="#how">How It Works</a>
    <a href="#studio">Studio</a>
    <a href="#tech">Built With</a>
    <a href="/voicemail" class="nav-link">Voicemail Copilot</a>
  </div>
  <button class="nav-cta" onclick="document.getElementById('studio').scrollIntoView({behavior:'smooth'})">
    Try It Now
  </button>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-glow">
    <div class="orb"></div><div class="orb"></div><div class="orb"></div>
  </div>

  <div class="hero-badge"><span class="pulse-dot"></span> ListenHacks 2025</div>

  <h1>
    Your Voice.<br>
    <span class="gradient">Our Producer.</span>
  </h1>

  <p class="subtitle">
    Hum a melody, speak your lyrics, pick a genre ‚Äî MemoMuse turns your raw voice memo
    into a fully produced track with vocals and instrumentation in under a minute.
  </p>

  <div class="hero-actions">
    <button class="btn-primary" onclick="document.getElementById('studio').scrollIntoView({behavior:'smooth'})">
      Start Creating
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
    </button>
    <button class="btn-secondary" onclick="document.getElementById('how').scrollIntoView({behavior:'smooth'})">
      See How It Works
    </button>
  </div>

  <div class="hero-visual">
    <div class="waveform-art" id="heroWave"></div>
  </div>
</section>

<!-- GENRES MARQUEE -->
<section class="genres-section" style="padding:2rem 0;overflow:hidden">
  <div class="genres-scroll" id="genreMarquee">
    <span class="genre-tag">Pop</span>
    <span class="genre-tag">Lo-Fi Hip Hop</span>
    <span class="genre-tag">Cinematic</span>
    <span class="genre-tag">R&B</span>
    <span class="genre-tag">Jazz</span>
    <span class="genre-tag">Electronic</span>
    <span class="genre-tag">Indie Folk</span>
    <span class="genre-tag">Hip Hop</span>
    <span class="genre-tag">Pop</span>
    <span class="genre-tag">Lo-Fi Hip Hop</span>
    <span class="genre-tag">Cinematic</span>
    <span class="genre-tag">R&B</span>
    <span class="genre-tag">Jazz</span>
    <span class="genre-tag">Electronic</span>
    <span class="genre-tag">Indie Folk</span>
    <span class="genre-tag">Hip Hop</span>
  </div>
</section>

<!-- HOW IT WORKS -->
<section id="how" class="section-center">
  <div class="section-label reveal">How It Works</div>
  <h2 class="section-title reveal">Four steps. One voice memo.</h2>
  <p class="section-sub reveal">
    Our AI pipeline transcribes, analyzes, generates, and mixes ‚Äî all from a single recording.
  </p>
  <div class="how-grid">
    <div class="how-card reveal">
      <div class="num">01</div>
      <h3>Record</h3>
      <p>Hum a melody, sing rough lyrics, or just talk through your idea. We capture it all.</p>
      <div class="glow-line"></div>
    </div>
    <div class="how-card reveal">
      <div class="num">02</div>
      <h3>Transcribe & Analyze</h3>
      <p>Whisper transcribes your audio. Gemini extracts mood, key, tempo, and clean lyrics.</p>
      <div class="glow-line"></div>
    </div>
    <div class="how-card reveal">
      <div class="num">03</div>
      <h3>Generate</h3>
      <p>Lyria creates the instrumental. ElevenLabs synthesizes studio-quality vocals. In parallel.</p>
      <div class="glow-line"></div>
    </div>
    <div class="how-card reveal">
      <div class="num">04</div>
      <h3>Mix & Deliver</h3>
      <p>Vocals and instrumentals are layered, balanced, and exported as a polished MP3.</p>
      <div class="glow-line"></div>
    </div>
  </div>
</section>

<!-- STUDIO -->
<section id="studio">
  <div class="section-center">
    <div class="section-label reveal">Studio</div>
    <h2 class="section-title reveal">Create something amazing.</h2>
    <p class="section-sub reveal">Pick your genre, hit record, and let the AI do the rest.</p>
  </div>

  <div style="display:flex;justify-content:center">
    <div class="studio-card reveal">
      <!-- Genre Chips -->
      <div class="genre-grid" id="genreGrid">
        <button class="genre-chip selected" data-genre="pop">Pop</button>
        <button class="genre-chip" data-genre="lo-fi hip hop">Lo-Fi</button>
        <button class="genre-chip" data-genre="hip hop">Hip Hop</button>
        <button class="genre-chip" data-genre="cinematic">Cinematic</button>
        <button class="genre-chip" data-genre="r&b">R&B</button>
        <button class="genre-chip" data-genre="indie folk">Indie Folk</button>
        <button class="genre-chip" data-genre="electronic">Electronic</button>
        <button class="genre-chip" data-genre="jazz">Jazz</button>
      </div>

      <!-- Record -->
      <div class="record-area">
        <button class="big-record-btn" id="recordBtn" onclick="toggleRecord()">
          <svg id="micIcon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>
          <svg id="stopIcon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display:none"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
        </button>
        <div class="record-label" id="recordLabel">Tap to record</div>
      </div>

      <!-- Live visualizer -->
      <div class="live-viz" id="liveViz"></div>

      <!-- Generate -->
      <button class="gen-btn" id="generateBtn" onclick="generate()" disabled>
        <div class="spinner"></div>
        <span class="btn-label">Generate Track</span>
      </button>

      <!-- Pipeline -->
      <div class="pipeline-steps" id="steps">
        <div class="pstep" id="ps-transcribe"><span class="pdot"></span>Transcribe</div>
        <div class="pstep-line"></div>
        <div class="pstep" id="ps-analyze"><span class="pdot"></span>Analyze</div>
        <div class="pstep-line"></div>
        <div class="pstep" id="ps-generate"><span class="pdot"></span>Generate</div>
        <div class="pstep-line"></div>
        <div class="pstep" id="ps-mix"><span class="pdot"></span>Mix</div>
      </div>

      <p class="status-text" id="status">Pick a genre and record your idea.</p>

      <!-- Output -->
      <div class="output-player" id="playerSection">
        <div class="output-header">
          <div class="output-tag">Your Track</div>
        </div>
        <div class="player-box">
          <audio id="outputAudio" controls></audio>
        </div>

        <div class="track-meta" id="trackMeta"></div>

        <div class="lyrics-display" id="lyricsDisplay">
          <div class="lyrics-label">
            <div class="eq-bars" id="eqBars"><span></span><span></span><span></span><span></span></div>
            Now Playing
          </div>
          <div id="lyricsContainer"></div>
        </div>

        <div class="output-actions">
          <button class="action-btn primary" id="downloadBtn" onclick="downloadTrack()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
            Download MP3
          </button>
          <button class="action-btn" onclick="copyLyrics()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
            Copy Lyrics
          </button>
        </div>

        <div class="vinyl-section" id="vinylSection">
          <div class="vinyl-wrap">
            <div class="vinyl-record" id="vinylDisc"></div>
            <div class="vinyl-label">
              <div class="v-title" id="vinylTitle">MemoMuse</div>
              <div class="v-genre" id="vinylGenre">Track</div>
            </div>
          </div>
          <div class="vinyl-info">
            <h3>Press Your Vinyl</h3>
            <p>Turn this track into a real vinyl record ‚Äî shipped to your door.</p>
          </div>
          <button class="shopify-btn" id="shopifyBtn" onclick="publishToShopify()">
            <div class="s-spinner"></div>
            <span class="s-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
              Buy as Vinyl ‚Äî $24.99
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- TECH STACK -->
<section id="tech" class="section-center">
  <div class="section-label reveal">Built With</div>
  <h2 class="section-title reveal">Powered by the best in AI</h2>
  <p class="section-sub reveal">Six services working in harmony to turn your voice into music.</p>
  <div class="tech-grid">
    <div class="tech-card reveal">
      <div class="tech-icon">üß†</div>
      <div class="tech-name">Google Gemini</div>
      <div class="tech-role">Lyric & Style Analysis</div>
    </div>
    <div class="tech-card reveal">
      <div class="tech-icon">üéπ</div>
      <div class="tech-name">Google Lyria</div>
      <div class="tech-role">Instrumental Generation</div>
    </div>
    <div class="tech-card reveal">
      <div class="tech-icon">üé§</div>
      <div class="tech-name">ElevenLabs</div>
      <div class="tech-role">Vocal Synthesis</div>
    </div>
    <div class="tech-card reveal">
      <div class="tech-icon">üëÇ</div>
      <div class="tech-name">OpenAI Whisper</div>
      <div class="tech-role">Audio Transcription</div>
    </div>
    <div class="tech-card reveal">
      <div class="tech-icon">‚úçÔ∏è</div>
      <div class="tech-name">Featherless AI</div>
      <div class="tech-role">Lyric Refinement</div>
    </div>
    <div class="tech-card reveal">
      <div class="tech-icon">üíæ</div>
      <div class="tech-name">Backboard.io</div>
      <div class="tech-role">Session Memory</div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div class="f-logo">MemoMuse</div>
  <p>Built at ListenHacks 2025 ‚Äî Toronto</p>
</footer>

<script>
  // ‚îÄ‚îÄ‚îÄ Hero waveform art ‚îÄ‚îÄ‚îÄ
  const heroWave = document.getElementById('heroWave');
  for (let i = 0; i < 60; i++) {
    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.style.animationDelay = (i * 0.06) + 's';
    bar.style.animationDuration = (1.2 + Math.random() * 1.2) + 's';
    heroWave.appendChild(bar);
  }

  // ‚îÄ‚îÄ‚îÄ Live visualizer bars ‚îÄ‚îÄ‚îÄ
  const liveViz = document.getElementById('liveViz');
  for (let i = 0; i < 40; i++) {
    const b = document.createElement('div');
    b.className = 'vbar';
    b.style.animationDelay = (i * 0.04) + 's';
    b.style.animationDuration = (0.4 + Math.random() * 0.5) + 's';
    liveViz.appendChild(b);
  }

  // ‚îÄ‚îÄ‚îÄ Stagger indexes for grid children ‚îÄ‚îÄ‚îÄ
  document.querySelectorAll('.how-card.reveal').forEach((c,i) => c.style.setProperty('--i',i));
  document.querySelectorAll('.tech-card.reveal').forEach((c,i) => c.style.setProperty('--i',i));

  // ‚îÄ‚îÄ‚îÄ Scroll reveal ‚îÄ‚îÄ‚îÄ
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
  }, { threshold: 0.15 });
  document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

  // ‚îÄ‚îÄ‚îÄ Card mouse tracking (inner glow follows cursor) ‚îÄ‚îÄ‚îÄ
  document.querySelectorAll('.how-card, .tech-card').forEach(card => {
    card.addEventListener('mousemove', e => {
      const r = card.getBoundingClientRect();
      card.style.setProperty('--mx', ((e.clientX - r.left) / r.width * 100) + '%');
      card.style.setProperty('--my', ((e.clientY - r.top) / r.height * 100) + '%');
    });
  });

  // ‚îÄ‚îÄ‚îÄ Parallax hero on scroll ‚îÄ‚îÄ‚îÄ
  const hero = document.querySelector('.hero');
  const heroGlow = document.querySelector('.hero-glow');
  window.addEventListener('scroll', () => {
    const sy = window.scrollY;
    if (sy < window.innerHeight) {
      const p = sy / window.innerHeight;
      hero.style.transform = 'translateY(' + (sy * 0.15) + 'px)';
      hero.style.opacity = 1 - p * 0.6;
      heroGlow.style.transform = 'translateY(' + (sy * 0.08) + 'px) scale(' + (1 + p * 0.1) + ')';
    }
  }, { passive: true });

  // ‚îÄ‚îÄ‚îÄ Genre selection ‚îÄ‚îÄ‚îÄ
  let selectedGenre = 'pop';
  document.querySelectorAll('.genre-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      document.querySelectorAll('.genre-chip').forEach(c => c.classList.remove('selected'));
      chip.classList.add('selected');
      selectedGenre = chip.dataset.genre;
    });
  });

  // ‚îÄ‚îÄ‚îÄ Recording ‚îÄ‚îÄ‚îÄ
  let mediaRecorder, audioChunks = [], audioBlob = null;
  const API_URL = window.location.origin;
  const $ = id => document.getElementById(id);

  async function toggleRecord() {
    const btn = $('recordBtn');
    const viz = $('liveViz');
    const label = $('recordLabel');

    if (mediaRecorder && mediaRecorder.state === 'recording') {
      mediaRecorder.stop();
      btn.classList.remove('recording');
      viz.classList.remove('active');
      btn.closest('.studio-card').classList.remove('recording-active');
      $('micIcon').style.display = '';
      $('stopIcon').style.display = 'none';
      label.textContent = 'Tap to record';
      return;
    }

    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.onstop = () => {
        audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        $('generateBtn').disabled = false;
        setStatus('Recording captured ‚Äî hit Generate!', '');
        stream.getTracks().forEach(t => t.stop());
      };

      mediaRecorder.start();
      btn.classList.add('recording');
      viz.classList.add('active');
      btn.closest('.studio-card').classList.add('recording-active');
      $('micIcon').style.display = 'none';
      $('stopIcon').style.display = '';
      label.textContent = 'Recording...';
      setStatus('Listening ‚Äî hum, sing, or speak your idea...', '');
    } catch (err) {
      setStatus('Microphone access denied.', 'error');
    }
  }

  function setStatus(text, type) {
    const el = $('status');
    el.classList.add('fade-out');
    setTimeout(() => {
      el.textContent = text;
      el.className = 'status-text' + (type ? ' ' + type : '');
    }, 150);
  }

  const STEPS = ['transcribe', 'analyze', 'generate', 'mix'];

  function showSteps(show) {
    $('steps').classList.toggle('visible', show);
  }

  function activateStep(step) {
    const idx = STEPS.indexOf(step);
    STEPS.forEach((s, i) => {
      const el = $('ps-' + s);
      el.classList.remove('active', 'done');
      if (i < idx) el.classList.add('done');
      else if (i === idx) el.classList.add('active');
    });
  }

  let currentAudioUrl = null;
  let currentLyrics = '';
  let lyricLines = [];
  let lyricSyncRAF = null;

  function buildLyrics(lyrics) {
    const container = $('lyricsContainer');
    container.innerHTML = '';
    lyricLines = [];

    const raw = lyrics.split('\n').filter(l => l.trim());
    raw.forEach((line, i) => {
      const div = document.createElement('div');
      div.className = 'lyric-line';
      const trimmed = line.trim();
      if (/^\[.*\]$/.test(trimmed)) {
        div.classList.add('section-label');
        div.textContent = trimmed.replace(/[\[\]]/g, '');
      } else {
        div.textContent = trimmed;
      }
      container.appendChild(div);
      lyricLines.push(div);
    });
  }

  function startLyricSync(audioEl) {
    if (lyricSyncRAF) cancelAnimationFrame(lyricSyncRAF);
    const eqBars = $('eqBars');

    function tick() {
      if (!audioEl.duration || audioEl.paused) {
        eqBars.classList.add('paused');
        lyricSyncRAF = requestAnimationFrame(tick);
        return;
      }
      eqBars.classList.remove('paused');
      const progress = audioEl.currentTime / audioEl.duration;
      const totalLines = lyricLines.length;
      const activeIdx = Math.min(Math.floor(progress * totalLines), totalLines - 1);

      lyricLines.forEach((el, i) => {
        el.classList.remove('active', 'past');
        if (i < activeIdx) el.classList.add('past');
        else if (i === activeIdx) el.classList.add('active');
      });

      // Auto-scroll to keep active line centered
      const activeLine = lyricLines[activeIdx];
      if (activeLine) {
        const display = $('lyricsDisplay');
        const top = activeLine.offsetTop - display.offsetTop - display.clientHeight / 2 + 40;
        display.scrollTo({ top: Math.max(0, top), behavior: 'smooth' });
      }

      lyricSyncRAF = requestAnimationFrame(tick);
    }
    tick();
  }

  function stopLyricSync() {
    if (lyricSyncRAF) { cancelAnimationFrame(lyricSyncRAF); lyricSyncRAF = null; }
    $('eqBars').classList.add('paused');
  }

  async function generate() {
    if (!audioBlob) return;
    const genBtn = $('generateBtn');
    genBtn.disabled = true;
    genBtn.classList.add('loading');
    $('playerSection').classList.remove('visible');
    stopLyricSync();

    showSteps(true);
    activateStep('transcribe');
    setStatus('Transcribing your recording...', '');

    const stages = [
      { step: 'analyze', text: 'Analyzing melody, mood, and lyrics...', delay: 5000 },
      { step: 'generate', text: 'Generating vocals & instrumentals (takes ~60s)...', delay: 5000 },
      { step: 'mix', text: 'Mixing your final track...', delay: 55000 },
    ];

    let t = 0;
    const timers = stages.map(s => {
      t += s.delay;
      return setTimeout(() => { activateStep(s.step); setStatus(s.text, ''); }, t);
    });

    const fd = new FormData();
    fd.append('audio', audioBlob, 'recording.webm');
    fd.append('genre', selectedGenre);

    try {
      const res = await fetch(`${API_URL}/generate`, { method: 'POST', body: fd });
      if (!res.ok) throw new Error(`Server ${res.status}`);

      const data = await res.json();

      timers.forEach(clearTimeout);
      STEPS.forEach(s => {
        $('ps-' + s).classList.remove('active');
        $('ps-' + s).classList.add('done');
      });

      currentAudioUrl = `${API_URL}${data.audio_url}`;
      currentLyrics = data.lyrics || '';

      const audio = $('outputAudio');
      audio.src = currentAudioUrl;

      // Build lyric lines and start sync
      buildLyrics(currentLyrics);
      $('playerSection').classList.add('visible');
      audio.play();
      startLyricSync(audio);

      // Re-sync on play/pause/seek
      audio.onplay = () => startLyricSync(audio);
      audio.onpause = () => $('eqBars').classList.add('paused');
      audio.onseeked = () => startLyricSync(audio);

      // Show metadata pills
      trackMeta = data;
      const meta = $('trackMeta');
      meta.innerHTML = '';
      if (data.genre) meta.innerHTML += `<span class="meta-pill">Genre <span class="meta-val">${data.genre}</span></span>`;
      if (data.mood) meta.innerHTML += `<span class="meta-pill">Mood <span class="meta-val">${data.mood}</span></span>`;
      if (data.bpm) meta.innerHTML += `<span class="meta-pill">BPM <span class="meta-val">${data.bpm}</span></span>`;
      if (data.key) meta.innerHTML += `<span class="meta-pill">Key <span class="meta-val">${data.key}</span></span>`;

      // Vinyl label
      $('vinylTitle').textContent = data.song_title || 'MemoMuse';
      $('vinylGenre').textContent = `${data.genre || 'Track'} ‚Ä¢ ${data.mood || ''}`;
      syncVinyl(audio);

      setStatus('Your track is ready!', 'success');
    } catch (err) {
      timers.forEach(clearTimeout);
      setStatus('Something went wrong ‚Äî try again.', 'error');
      showSteps(false);
      console.error(err);
    }

    genBtn.disabled = false;
    genBtn.classList.remove('loading');
  }

  function downloadTrack() {
    if (!currentAudioUrl) return;
    const a = document.createElement('a');
    a.href = currentAudioUrl;
    a.download = `${(trackMeta.song_title || 'MemoMuse_Track').replace(/[^a-zA-Z0-9 ]/g, '').replace(/ /g, '_')}.mp3`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  function copyLyrics() {
    if (!currentLyrics) return;
    navigator.clipboard.writeText(currentLyrics).then(() => {
      const btn = event.currentTarget;
      const orig = btn.innerHTML;
      btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> Copied!';
      setTimeout(() => { btn.innerHTML = orig; }, 2000);
    });
  }

  // ‚îÄ‚îÄ‚îÄ Vinyl spin sync ‚îÄ‚îÄ‚îÄ
  function syncVinyl(audioEl) {
    const disc = $('vinylDisc');
    if (!disc) return;
    const update = () => {
      if (audioEl.paused) disc.classList.remove('spinning');
      else disc.classList.add('spinning');
      requestAnimationFrame(update);
    };
    update();
  }

  // ‚îÄ‚îÄ‚îÄ Shopify integration ‚îÄ‚îÄ‚îÄ
  let shopifyConfig = null;
  let trackMeta = {};

  async function loadShopifyConfig() {
    try {
      const res = await fetch(`${API_URL}/api/config`);
      shopifyConfig = await res.json();
    } catch (e) { console.warn('No Shopify config'); }
  }
  loadShopifyConfig();

  async function publishToShopify() {
    const btn = $('shopifyBtn');
    btn.classList.add('loading');
    btn.disabled = true;
    const label = btn.querySelector('.s-label span') || btn.querySelector('.s-label');

    try {
      const res = await fetch(`${API_URL}/api/publish`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          song_title: trackMeta.song_title || 'Untitled Track',
          lyrics: trackMeta.lyrics || currentLyrics || '',
          genre: trackMeta.genre || '',
          mood: trackMeta.mood || '',
          bpm: trackMeta.bpm || 120,
          key: trackMeta.key || '',
          audio_url: currentAudioUrl || '',
        })
      });
      const data = await res.json();

      if (data.error) {
        alert('Could not create product: ' + data.error);
      } else if (data.product_url) {
        if (label) label.textContent = 'Published! View in Store ‚Üí';
        window.open(data.product_url, '_blank');
      }
    } catch (err) {
      console.error('Publish error:', err);
      alert('Failed to publish ‚Äî check the console.');
    }

    btn.classList.remove('loading');
    btn.disabled = false;
  }
</script>
</body>
</html>
